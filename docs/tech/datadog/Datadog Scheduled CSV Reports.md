https://docs.datadoghq.com/ja/logs/reports/  

## 概要

Scheduled CSV Reports（スケジュール済みCSVレポート）は、メールまたはSlackを通じて定期的に構造化されたデータエクスポートを自動的に受信できる機能です。この機能は、Datadogプラットフォームにログインすることなく、主要メトリクスの定期的なスナップショットを提供することで、運用、コンプライアンス、および経営層のステークホルダーをサポートします。

  
## クエリの定義

CSV Reportをスケジュールするには、クエリが以下の条件を満たす必要があります：

  
- クエリはLog Explorerから作成する必要がある
- クエリ結果はリストまたはテーブルとして表示される（他の可視化タイプはサポートされていない）
- クエリは複合クエリではない（サブクエリなし）
- クエリは計算フィールドまたはReference Tablesを使用していない
- CSVは最大50,000行に制限される

  
## CSV レポートをスケジュールする

1. **More...** をクリック
2. **Schedule CSV Report** を選択
3. 開いた設定モーダルで、レポートの送信時期と頻度を決定するスケジュールを設定
4. レポートの設定
	- レポートのタイトルを定義
	- 結果レポートに表示される時間範囲を決定するための時間枠を設定
	- レポートの時間枠は、ダッシュボードに表示される時間枠とは異なる設定が可能
5. 受信者の追加
	- メール受信者
		- メール受信者を追加するには、メールアドレスを入力
		- Datadogアカウントに関連付けられたメールアドレスは自動的に受信者として追加される
		- 自分自身を受信者から削除するには、メールアドレスにカーソルを合わせ、横に表示されるゴミ箱アイコンをクリック
	- Slack受信者
		- Slack受信者を追加するには、利用可能なドロップダウンからSlackワークスペースとチャンネルを選択
		- Slackワークスペースが表示されない場合は、Datadog Slack Integrationがインストールされていることを確認
		- Slackワークスペース内のすべてのパブリックチャンネルは自動的にリストアップされる
		- プライベートSlackチャンネルを選択するには、SlackでそのチャンネルにDatadog Slackボットを招待する必要がある
		- Slackにテストメッセージを送信するには、チャンネル受信者を追加して **Send Test Message** をクリック

  

## レポートの管理

CSVレポートを表示するには、Log Explorerに移動して **Reports** タブをクリックします。

**注意**: レポートはSaved Viewsに紐付けられておらず、Reportsタブからのみアクセスできます。

### 必要な権限

- 独自のレポートスケジュールを作成するには、**CSV Report Schedules Write** 権限が必要
- 他のユーザーのレポートスケジュールを変更するには、**CSV Report Schedules Manage** 権限が必要
- レポート作成後、適切な権限があれば、購読、購読解除、スケジュールの編集、レポートの削除が可能
- CSV Report Schedules Write または CSV Report Schedules Manage 権限がない場合でも、メールから直接レポートの購読を解除することができる

  
### レポートビュー

| レポートビュー               | 説明                                          | 必要な権限                       |
| --------------------- | ------------------------------------------- | --------------------------- |
| Created by you（自分が作成） | Log Explorerから作成したすべてのスケジュール済みCSVレポートを表示    | CSV Report Schedules Write  |
| All Reports（すべてのレポート） | 所属する組織のLog Explorer内のすべてのスケジュール済みCSVレポートを表示 | CSV Report Schedules Manage |
| Subscribed（購読中）       | 自分が購読しているすべてのスケジュール済みCSVレポートを表示             | CSV Report Schedules Write  |

  

---
## 具体的な設定手順（logErrorを週次でSlackに通知する場合）

### 前提条件の確認

1. **Datadog-Slack統合の確認**
	- Datadogにログイン
	- 左メニューから **Integrations** を開く
	- 検索バーで「Slack」を検索
	- Slack統合がインストール済みであることを確認
	- 未インストールの場合は、**Install** をクリックして設定

  
2. **必要な権限の確認**
	- 自分のアカウントに **CSV Report Schedules Write** 権限があることを確認
	- 権限がない場合は、Datadog管理者に権限付与を依頼

  
### ステップ1: Log Explorerでクエリを作成

1. Datadogの左メニューから **Logs > Explorer** を開く
2. 検索バーでlogErrorのフィルターを設定
	```
	例: service:your-service-name status:error
	または: @error_type:logError
	```
	プロジェクトで使用しているログ属性に応じて適切なクエリを作成
3. 時間範囲を設定（例: Past 7 Days）
	- 右上の時間選択ドロップダウンから選択
4. 可視化タイプを **List** または **Table** に変更
	- 画面左側の可視化オプションから選択
	- グラフやその他の可視化タイプは使用できないため注意
5. 表示する列（カラム）を調整
	- 必要な情報（timestamp, message, service, 等）が表示されるように設定
	- カラムの追加/削除は画面上部の設定から可能


### ステップ2: CSV レポートをスケジュールする

1. クエリが正しく設定できたら、画面右上の **More...** ボタン（三点リーダー ⋯）をクリック
2. ドロップダウンメニューから **Schedule CSV Report** を選択
3. **設定モーダル**が開くので、以下を入力：

#### スケジュール設定

- **Report Title（レポートタイトル）**:

```

例: 週次 logError レポート

```

- **Frequency（頻度）**:
- **Weekly（週次）** を選択
- 曜日を選択（例: 毎週月曜日）
- 時刻を選択（例: 09:00 JST）

#### 時間範囲設定

- **Time Frame（時間枠）**:
- **Past 7 Days（過去7日間）** を選択
- これにより、毎週過去7日分のlogErrorが集計される

#### 受信者設定

**Slack受信者を追加:**
1. **Recipients（受信者）** セクションで **Add Slack Channel** をクリック
2. **Slack Workspace** ドロップダウンから、統合済みのワークスペースを選択
	- 表示されない場合は、Slack統合の設定を確認
3. **Slack Channel** ドロップダウンから、通知先チャンネルを選択
	- 例: `#alerts`, `#monitoring`, `#error-logs` など
	- プライベートチャンネルの場合:
4. Slackで該当チャンネルを開く
5. `/invite @Datadog` を入力してDatadog botを招待
6. その後、Datadogのドロップダウンに表示される
7. （オプション）**Send Test Message** ボタンをクリックして、テストメッセージを送信
	- Slackチャンネルに正しく届くことを確認

  
**メール受信者を追加（オプション）:**
1. メールアドレスを入力フィールドに入力
2. 複数のメールアドレスを追加可能
3. 自分のアカウントメールは自動的に追加される（削除も可能）

  
### ステップ3: レポートを保存

1. すべての設定を確認
2. モーダル下部の **Schedule Report** ボタンをクリック
3. 設定が保存され、指定したスケジュールでレポートが自動送信される

  
### ステップ4: 設定の確認と管理

1. Log Explorerの **Reports** タブを開く
	- 左メニューから **Logs > Explorer** を開く
	- 上部タブから **Reports** を選択
2. 作成したレポートが **Created by you** ビューに表示される
3. レポートの編集/削除
	- レポート行の右側にある **⋯** メニューをクリック
	- **Edit** で設定変更
	- **Delete** で削除
	- **Subscribe/Unsubscribe** で購読管理


### 動作確認

- 初回送信は、設定したスケジュールの最初のタイミングで実行される
- Slackチャンネルで以下を確認:
- CSVファイルが添付されたメッセージが届く
- CSVファイル内にlogErrorのログが含まれている
- データの期間が正しい（過去7日間）
  
### トラブルシューティング

#### Slackにレポートが届かない場合

1. **Slack統合を確認**
	- Integrations > Slack で統合が有効か確認
	- 再認証が必要な場合は、Reconnect をクリック
2. **チャンネル権限を確認**
	- プライベートチャンネルの場合、Datadog botが招待されているか確認
	- Slackで `/invite @Datadog` を実行
3. **権限を確認**
	- CSV Report Schedules Write 権限があるか確認

#### CSVが空の場合

1. **クエリを確認**
	- Log Explorerで手動実行して、データが返ってくるか確認
	- フィルター条件が正しいか確認
2. **時間範囲を確認**
	- 指定した期間にログデータが存在するか確認
3. **50,000行制限**
	- CSVは最大50,000行まで
	- それ以上のデータがある場合は、フィルター条件を追加して絞り込む

  
---

  
## まとめ

この設定により、週次で自動的に：
- logErrorのログがCSV形式で抽出される
- 指定したSlackチャンネルにファイルが送信される
- Datadogにログインせずに、ステークホルダーがデータを確認できる

定期的なログ監視とコンプライアンス対応が効率化されます。
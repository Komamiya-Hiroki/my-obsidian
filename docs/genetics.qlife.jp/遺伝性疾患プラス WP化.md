# 遺伝性疾患プラス WordPress移行手順書

## 概要

- **移行元**: Nuxt.js + Directus (https://genetics.qlife.jp/)
- **移行先**: WordPress
- **GitHub**: https://github.com/QLife-Inc/genetics.qlife.jp

---

## Step1: 現状調査

### やること

#### コンテンツの棚卸し
- **ページ数や記事数、画像数の把握**
  - 管理画面で確認 or SELECT文で各コレクション別にデータ数を取得（公開ステータス込み）
  - 最終更新日の範囲の確認（いつからいつまでのデータか）
- **使用機能の洗い出し**

#### Directus のDBの構造把握
- **各テーブルのフィールド情報を記録**
  - コンフルにも一応記載はあるが、更新されていない可能性があるので実テーブルで確認

#### 主要コレクション
- **遺伝性疾患解説** - 疾患に関する詳細解説記事
- **遺伝性疾患 関連記事** - 関連する記事コンテンツ
- **特集** - 特集企画のメタ情報
- **特集記事** - 特集に含まれる個別記事
- **用語集** - 医療用語の解説
- **問い合わせ** - お問い合わせフォームデータ
- **インタビュー対象者** - インタビュー記事の対象者情報
- **限定公開記事** - 会員限定コンテンツ
- **ニュース** - ニュース記事
- **その他の記事** - 分類されていない記事
- **専門家インタビュー** - 専門家へのインタビュー記事
- **支援者** - サイト支援者情報
- **タグ** - 記事分類用タグ
- **学習** - 学習コンテンツのメタ情報
- **学習記事** - 学習用記事

#### 現在のサイトのURL構造を確認
- **実際のサイトでURL確認**
  - 各種ページのURLをブラウザのアドレスバーで確認し記録
- **URL パターンの分類**
- **特殊なURL の確認**
  - 日本語が含まれるURL
  - 階層が深いURL
  - パラメータが付くURL
- **内部リンクの調査**
  - 記事内で他の記事へのリンクがどのように設定されているか
  - 相対パス・絶対パスの使い分け
            

## Step2: WordPressサイト設定

### やること

#### wordpress.comでのサイト初期設定
- サイト名：「遺伝性疾患プラス」stg & prod
- ドメイン設定
- 基本設定（タイムゾーン、言語など）
- SSL証明書・セキュリティ設定の確認
- GitHub ActionsでのCI/CDパイプライン構築

#### 必要な機能の追加
- カスタム投稿タイプ機能
- カスタムフィールド機能（疾患コード、英名などの詳細情報を管理）
- パーマリンク設定

#### 設定すべきカスタム投稿タイプ

**メインコンテンツ用**
- `disease` - 遺伝性疾患解説
- `news` - ニュース
- `interview` - 専門家インタビュー
- `glossary` - 用語集（プラグイン使用）

**関連コンテンツ用**
- `disease_article` - 遺伝性疾患 関連記事
- `other_article` - その他の記事
- `feature` - 特集（親）
  - `feature_article` - 特集記事（子）
- `tutorial` - 学習（親）
  - `tutorial_article` - 学習記事（子）

**特殊コンテンツ用**
- `limited_article` - 限定公開記事
- `supporter` - 支援者

#### 必要な追加機能
- 会員制機能 - 限定公開記事のアクセス制御
- 階層構造管理 - 特集と特集記事、学習と学習記事の親子関係
- 問い合わせフォーム - Contact Form 7などのプラグイン

#### URL設定とリダイレクト

**階層構造のURL**
- `/features/{特集名}/{記事名}` - 特集記事
- `/tutorials/{学習名}/{記事名}` - 学習記事
- `/diseases/{疾患名}/{カテゴリ}/{記事名}` - 疾患関連記事

**特殊なURL**
- `/limited-release/{記事名}` - 限定公開記事
- `/supporters/{支援者名}` - 支援者ページ
- `/glossary/{用語名}` - 用語集
        

## Step3: データ移行 & デザイン調整

### 主な移行手段

#### WordPress REST API
- WordPress.com で OAuth認証 & API トークン取得
- レートリミットの確認
- 接続テスト

#### WordPress の標準インポート

#### Directus REST API
- API トークン生成
- レートリミットの確認
- 接続テスト

### 主な移行手順

1. Directus からデータを取得
2. データクリーニング
3. WordPress.com へ登録

### 実行前の確認

#### 1. 移行環境の準備完了確認
- WordPress.com Business プランの有効化
- 必要なプラグインのインストール・設定完了
- カスタム投稿タイプ・フィールドの設定完了
- テーマの基本設定完了

#### 2. バックアップの取得
- Directusデータベースの完全バックアップ
- 現在のサイトのファイル・画像バックアップ
- WordPress.com初期状態のエクスポート

#### 3. 移行ツールの最終テスト
- API接続の確認
- 少量データでの移行テスト
- エラーハンドリングの動作確認

### データ移行&フロントエンド調整

一度に全てのデータ移行を行うのではなく、コンテンツ単位でデータ移行とデザイン調整を行う

#### 第1段階：基盤データ
1. タグ（全コンテンツで使用されるため最初に移行）
2. 支援者（インタビュー記事で参照されるため）
3. インタビュー対象者（各記事で参照されるため）

#### 第2段階：メインコンテンツ
移行&デザインをコンテンツ単位で行う
4. 遺伝性疾患解説
5. 用語集
6. ニュース
7. 専門家インタビュー

#### 第3段階：関連コンテンツ
8. 遺伝性疾患 関連記事
9. その他の記事
10. 特集 → 特集記事（親子関係を維持）
11. 学習 → 学習記事（親子関係を維持）

#### 第4段階：特殊コンテンツ
12. 限定公開記事（アクセス制御）
13. 問い合わせデータ（必要に応じて）

### 関連付けの処理

#### 複雑な関連付けが必要なもの
- **専門家インタビュー** ↔ **支援者**
- **遺伝性疾患 関連記事** ↔ **遺伝性疾患解説**
- **特集記事** ↔ **特集**
- **学習記事** ↔ **学習**
- **インタビュー対象者** ↔ 各種記事
